{% extends 'base.html.twig' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
    <h2>Projects</h2>

    <div>
        <a href="{{ path('create_project') }}" class="btn btn-sm btn-primary ">Create project</a>

        {% if projects %}
            <ul>
                {% for project in projects %}
                    <li>
                         {{ project.remoteGitRepository.project }}

                        <a href="{{ path('define_task', {projectId: project.projectId}) }}">Define task</a>
                        <a href="{{ path('delete_project', {projectId: project.projectId}) }}" onclick="return confirm('Are you sure you want to delete this project?');">Delete project</a>
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>

    <ul>
        {% for task in tasks %}
            <li>
                {{ task.name }}
                <a href="{{ path('run_task', {taskId: task.taskId}) }}">Run</a>
                <a href="{{ path('redefine_task', {taskId: task.taskId}) }}">Edit</a>
                <a href="{{ path('remove_task', {taskId: task.taskId}) }}" onclick="return confirm('Are you sure you want to delete this task?');">Delete</a>
            </li>
        {% endfor %}
    </ul>



    {% if jobs is empty %}
        <div class="alert alert-dark" role="alert">
            No jobs executed yet!
        </div>
    {% endif %}

    {% if jobs %}
        <div class="list-group jobs-list-group">

            {% for job in jobs %}
                <a href="{{ path('job_detail', {jobId: job.jobId}) }}" class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                        <h5 class="mb-1">
                            {% if not job.finished %}
                                <span class="spinner-border text-primary spinner-border-sm" style="border-width: .1em" role="status"></span>
                            {% endif %}

                            {% if job.succeeded %}
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle-fill text-success" viewBox="0 0 16 16">
                                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                                </svg>
                            {% endif %}

                            {% if job.failed %}
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle-fill text-danger" viewBox="0 0 16 16">
                                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"/>
                                </svg>
                            {% endif %}

                            {{ job.taskName }}
                        </h5>
                        {% if job.executionTime %}
                            <small class="text-muted">
                                {% if job.executionTime >= 60 %}
                                    {$job->executionTime / 60|floor}m
                                {% endif %}
                                {{ job.executionTime % 60|round }}s
                            </small>
                        {% endif %}
                    </div>
                    <small class="text-muted">{{ job.scheduledAt|date('j. n. H:i') }}</small>
                </a>
            {% endfor %}
        </div>
    {% endif %}
{% endblock %}
